---
layout: post
title: "ELK 收集k8s容器日志最佳实践"
tags: DevOps ELK
---


## 简介  
----
* 关于日志收集这个主题，这已经是第三篇了，为什么一再研究这个课题，因为这个课题实在太重要，而当今优秀的开源解决方案还不是很明朗；
* 就docker微服务化而言，研发有需求标准输出，也有需求文件输出，每次登录到服务器上去查看日志又多有不妥；现有的解决方案ELK，每次收集新应用日志都要更改配置文件重新适配日志路径足以让我们崩溃；
* 对于k8s，没有日志系统推行工作就无法进行，总不能让开发小伙伴登录到k8s上去找日志吧，鬼知道在哪个pod里；当然，k8s官方提供了解决方案efk，efk最大的问题就是无法对日志有效分组，所有日志都在一个索引里，影响查询速度不说，对于研发小伙伴查找属于自己应用的日志也很困难，不得不说，这个解决方案很鸡肋；
* 综上三条，能够统筹普通应用、docker微服务、k8s的日志收集方案迫在眉睫，今天就将能解决这些问题的日志收集方案的最佳实践分享给大家；
* 该实践采用的是阿里云的开源工具 [log-pilot](https://github.com/AliyunContainerService/log-pilot/blob/master/docs/filebeat/docs.md)采集日志，采集的过程中就将各种日志标签分类，类似最近比较火的垃圾分类，结构图如下，

![img-w500](/images/201907041728.png)