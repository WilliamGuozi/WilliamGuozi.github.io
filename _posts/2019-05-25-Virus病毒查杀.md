---
layout: post
title: "Virus病毒查杀"
tags: DevOps Virus
---

## 简介  
----
* 小伙伴们，大家好，今天分享一次Linux系统杀毒的经历，还有个人的一些总结，希望对大家有用。
* 我遇到的一个挖矿的病毒，在挖一种叫门罗币（XMR）的数字货币，行情走势请看<https://www.feixiaohao.com/currencies/monero>，该病毒的特征是会占满你的CPU。
* 该病毒的侵入方式是通过扫描主机的Redis端口，一般默认为6379，通过Redis命令将程序注入到你的主机，对的，没有设置密码的那种，我们的测试环境主机就因此中招。


## 病毒的发现和侦破

1. 起初，收到cpu的报警信息，于是先登录到阿里云上，查看了该机器的情况，发现了注入命令

![img-w500](/images/201906040633.png)

## 病毒清理的总结

top查找占用资源较多的进程pid
通过pstree -H PID -a查看高亮部分，查看其可疑父进程及相关执行命令（也可通过/proc/PID/下文件查看）
查看被修改的 find /etc/cron* -type f -mtime -30
crontab中如果是正常命令，可能为篡改命令，通过m5dsum COMMAND和正常机器命令校验，更新命令
更新或清除crontab中命令相关文件
清除crontab内容
kill掉病毒pid和其可疑父进程pid; kill -9 PID PPID